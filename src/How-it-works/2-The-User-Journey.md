# 2. رحلة المستخدم: كيف يعمل النظام خطوة بخطوة؟

هذا المستند يشرح بالتفصيل كيف يتفاعل كل نوع من المستخدمين مع نظام "المائدة"، بدءاً من الزبون وانتهاءً بالمدير، مع الأخذ في الاعتبار قدرات العمل في وضعي الاتصال بالإنترنت وعدم الاتصال.

---

## أولاً: رحلة الزبون (تجربة سهلة وممتعة)

1.  **مسح رمز QR:** يجلس الزبون على طاولته، ويستخدم كاميرا هاتفه لمسح رمز QR الموجود على الطاولة.
2.  **فتح القائمة الرقمية:** يتم توجيه الزبون فوراً إلى صفحة قائمة الطعام الرقمية الخاصة بطاولته. الرابط فريد وآمن لكل طاولة، مما يمنع أي تلاعب.
3.  **تصفح القائمة:** يتصفح الزبون قائمة طعام جذابة وسهلة الاستخدام، مقسمة إلى فئات (مقبلات، رئيسية، حلويات...).
4.  **إضافة إلى السلة:** عند اختيار صنف، يضغط على زر "إضافة". يمكنه إضافة أي عدد من الأصناف وزيادة الكمية.
5.  **مراجعة السلة:** يفتح الزبون سلة الطلبات ليرى كل ما اختاره والمجموع الإجمالي.
6.  **إرسال الطلب للموافقة:** عندما يكون جاهزاً، يضغط على "إرسال للموافقة". **ملاحظة هامة:** الطلب لا يذهب مباشرة إلى المطبخ بعد. هذه هي الخطوة الأولى في نظام التأكيد الآمن.

### نظام التأكيد متعدد المستويات (من منظور الزبون)

7.  **انتظار الموافقة:** تظهر للزبون شاشة تفيد بأن طلبه "بانتظار موافقة المطعم".
8.  **استلام الفاتورة النهائية:** بعد موافقة الشيف والمحاسب، تتغير شاشة الزبون لتعرض له "الفاتورة النهائية" مع أي رسوم خدمة أو ضرائب.
9.  **التأكيد النهائي:** يجب على الزبون الآن الضغط على زر **"تأكيد وإرسال للمطبخ"**. هذه هي الضغطة الحاسمة التي تحول الطلب إلى "مؤكد".
10. **الطلب قيد التحضير:** تظهر له شاشة أخيرة تخبره بأن طلبه قيد التحضير.
11. **طلب المساعدة أو الفاتورة:** في أي وقت، يمكن للزبون من خلال شاشته طلب المساعدة من النادل أو طلب الفاتورة النهائية لإنهاء زيارته.

---

## ثانياً: رحلة الموظفين (الكفاءة والتنظيم في كل الظروف)

هنا تظهر قوة نظام المزامنة والعمل دون اتصال.

### أ. الشيف (قلب المطبخ)

1.  **شاشة كانبان (Kanban):** يفتح الشيف واجهته الخاصة التي تنقسم إلى عمودين رئيسيين:
    *   **"طلبات بانتظار موافقتك":** هنا تظهر الطلبات الجديدة التي أرسلها الزبائن فوراً، بفضل Supabase Realtime.
    *   **"طلبات قيد التحضير":** هنا تظهر الطلبات التي تم تأكيدها نهائياً.
2.  **الموافقة على الطلب (متصل أو غير متصل):** يراجع الشيف الطلب الجديد ويضغط "موافقة".
    *   **إذا كان متصلاً:** يتم تحديث حالة الطلب في Supabase فوراً.
    *   **إذا كان غير متصل:** يتم تحديث الحالة في قاعدة البيانات المحلية (IndexedDB)، وتضاف العملية إلى "قائمة انتظار المزامنة". عند عودة الاتصال، يتم إرسال الموافقة تلقائياً.
3.  **بدء التحضير:** بعد أن يؤكد الزبون الطلب نهائياً، يظهر الطلب في عمود "قيد التحضير" مع مؤقت يبدأ بالعد لمتابعة وقت التحضير.
4.  **إعلان جاهزية الطلب:** عند الانتهاء من تحضير الطلب، يضغط الشيف على "الطلب جاهز". مرة أخرى، يتم تحديث الحالة محلياً ثم مزامنتها مع السحابة.

### ب. المدير/المحاسب (العقل المدبر)

1.  **لوحة التحكم الرئيسية:** يرى المدير عرضاً مرئياً مباشراً لجميع طاولات المطعم وألوانها التي تعكس حالتها. هذه الواجهة تتحدث لحظياً بفضل Supabase Realtime.
2.  **الموافقة المالية (متصل أو غير متصل):** عندما يوافق الشيف على طلب، يتغير لون الطاولة في واجهة المدير إلى "بانتظار موافقة المحاسب". يقوم المدير بمراجعة الطلب مالياً، يضيف أي رسوم خدمة أو ضرائب، ثم يضغط "موافقة". هذا الإجراء يتم تسجيله ومزامنته بنفس آلية الشيف.
3.  **متابعة شاملة:** يمكن للمدير مراقبة جميع حالات الطلبات من البداية إلى النهاية.
4.  **إدارة كل شيء:** من القائمة الجانبية، يمكن للمدير الوصول إلى:
    *   **إدارة القائمة:** إضافة وتعديل وحذف أصناف الطعام.
    *   **المصاريف:** تسجيل جميع نفقات المطعم.
    *   **التقارير:** الاطلاع على تحليلات المبيعات والأرباح.
    *   **الإعدادات:** إدارة المستخدمين وتوليد رموز QR.
    *   **نقطة البيع (POS):** تسجيل الطلبات الخارجية (Takeaway) بسرعة.

---

بهذه الطريقة، يضمن نظام "المائدة" أن كل شخص في المطعم يعرف بالضبط ما يجب عليه فعله، وأن العمل يستمر بسلاسة حتى في حالة انقطاع الإنترنت، مما يقلل الأخطاء ويزيد من سرعة الخدمة ورضا الزبائن.
