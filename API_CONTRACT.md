# العقد البرمجي (API Contract) لمشروع "المائدة"

هذه الوثيقة هي المرجع الرسمي الذي يحدد كيفية تفاعل الواجهة الأمامية (Frontend) مع الواجهة الخلفية (Backend). إنها تحدد نماذج البيانات، هيكل قاعدة البيانات المقترح، ونقاط النهاية (API Endpoints) اللازمة لتشغيل التطبيق.

---

## 1. فلسفة التصميم

*   **RESTful API:** نعتمد على مبادئ REST لتصميم الـ API، مما يجعله منظماً ومتوقعاً.
*   **JSON:** جميع الطلبات والاستجابات ستكون بصيغة JSON.
*   **المسارات (Routes):** تبدأ جميع مسارات الـ API بـ `/api/v1/`.
*   **التوثيق الذاتي:** أسماء المسارات والموارد واضحة وتعبر عن وظيفتها.

---

## 2. نماذج البيانات (Data Models)

هذه هي نماذج البيانات الأساسية التي يتعامل معها التطبيق.

### أ. الصنف (MenuItem)

| الحقل (Field)     | النوع (Type) | الوصف                                        | ملاحظات                   |
| ------------------ | ------------- | -------------------------------------------- | ------------------------- |
| `id`               | `string`      | معرف فريد (UUID)                            | Primary Key               |
| `name`             | `string`      | اسم الصنف باللغة العربية                    | مطلوب                     |
| `name_en`          | `string`      | اسم الصنف باللغة الإنجليزية                 | اختياري                   |
| `description`      | `text`        | وصف الصنف بالعربية                          | اختياري                   |
| `description_en`   | `text`        | وصف الصنف بالإنجليزية                       | اختياري                   |
| `price`            | `decimal`     | سعر الصنف                                   | مطلوب، دقة عالية          |
| `category`         | `string`      | تصنيف الصنف (main, appetizer, drink, dessert) | مطلوب                     |
| `offer`            | `string`      | نص العرض بالعربية (مثال: خصم 20%)          | اختياري                   |
| `offer_en`         | `string`      | نص العرض بالإنجليزية                        | اختياري                   |
| `is_available`     | `boolean`     | هل الصنف متاح حالياً؟                      | افتراضي: `true`           |
| `created_at`       | `timestamp`   | تاريخ إنشاء الصنف                           | يضاف تلقائياً              |
| `updated_at`       | `timestamp`   | تاريخ آخر تحديث للصنف                       | يضاف تلقائياً              |

### ب. الطلب (Order)

| الحقل (Field)              | النوع (Type)             | الوصف                                            | ملاحظات                             |
| --------------------------- | ------------------------- | ----------------------------------------------- | ----------------------------------- |
| `id`                        | `string`                  | معرف فريد (UUID)                                | Primary Key                         |
| `table_id`                  | `integer`                 | رقم الطاولة المرتبط بها الطلب                   | مطلوب                               |
| `status`                    | `string`                  | حالة الطلب (new, in_progress, ready, completed)  | مطلوب، افتراضي: `new`              |
| `total`                     | `decimal`                 | المبلغ الإجمالي للطلب                           | يتم حسابه تلقائياً                  |
| `timestamp`                 | `timestamp`               | وقت إنشاء الطلب                                 | يضاف تلقائياً                        |
| `confirmation_timestamp`    | `timestamp`               | وقت تأكيد الطلب من قبل الشيف                    | اختياري                             |
| `completion_timestamp`      | `timestamp`               | وقت إتمام الطلب                                 | اختياري                             |

### ج. تفاصيل الطلب (OrderItem) - (جدول وسيط)

هذا الجدول يربط بين الطلبات والأصناف.

| الحقل (Field) | النوع (Type) | الوصف                    | ملاحظات                               |
| -------------- | ------------- | ----------------------- | ------------------------------------- |
| `id`           | `string`      | معرف فريد (UUID)       | Primary Key                           |
| `order_id`     | `string`      | معرف الطلب (Foreign Key) | يربط مع جدول `Orders`                 |
| `menu_item_id` | `string`      | معرف الصنف (Foreign Key) | يربط مع جدول `MenuItems`              |
| `quantity`     | `integer`     | كمية الصنف المطلوب     | مطلوب                                 |
| `price_at_time`| `decimal`     | سعر الصنف وقت الطلب    | لضمان دقة الفواتير حتى لو تغير السعر |

### د. المصروف (Expense)

| الحقل (Field)   | النوع (Type)   | الوصف                                                               | ملاحظات         |
| ---------------- | -------------- | -------------------------------------------------------------------- | --------------- |
| `id`             | `string`       | معرف فريد (UUID)                                                    | Primary Key     |
| `description`    | `string`       | وصف المصروف بالعربية                                                | مطلوب           |
| `description_en` | `string`       | وصف المصروف بالإنجليزية                                             | اختياري         |
| `amount`         | `decimal`      | مبلغ المصروف                                                        | مطلوب           |
| `date`           | `date`         | تاريخ المصروف                                                       | مطلوب           |
| `category`       | `string`       | تصنيف المصروف (rent, bills, salaries, supplies, maintenance, etc.) | مطلوب           |
| `created_at`     | `timestamp`    | تاريخ التسجيل                                                      | يضاف تلقائياً    |

---

## 3. نقاط النهاية (API Endpoints)

### أ. إدارة قائمة الطعام (`/api/v1/menu-items`)

*   **`GET /`**: جلب جميع أصناف القائمة.
*   **`POST /`**: إضافة صنف جديد إلى القائمة.
    *   **Body**: `{ name, name_en, description, description_en, price, category, offer, offer_en }`
*   **`GET /:id`**: جلب تفاصيل صنف معين.
*   **`PUT /:id`**: تحديث بيانات صنف معين.
    *   **Body**: (نفس حقول الإضافة)
*   **`DELETE /:id`**: حذف صنف معين من القائمة.

### ب. إدارة الطلبات (`/api/v1/orders`)

*   **`GET /`**: جلب جميع الطلبات الحالية (التي لم تكتمل).
    *   **Query Params**: `?status=new` or `?status=in_progress`
*   **`POST /`**: إنشاء طلب جديد (يتم من واجهة الزبون أو الـ POS).
    *   **Body**: `{ table_id, items: [{ menu_item_id, quantity }] }`
*   **`GET /:id`**: جلب تفاصيل طلب معين مع أصنافه.
*   **`PUT /:id/status`**: تحديث حالة الطلب (يتم من واجهة الشيف).
    *   **Body**: `{ status: "in_progress" | "ready" | "completed" }`

### ج. إدارة المصاريف (`/api/v1/expenses`)

*   **`GET /`**: جلب جميع المصاريف.
    *   **Query Params**: `?startDate=YYYY-MM-DD&endDate=YYYY-MM-DD&category=rent`
*   **`POST /`**: تسجيل مصروف جديد.
    *   **Body**: `{ description, description_en, amount, date, category }`
*   **`GET /:id`**: جلب تفاصيل مصروف معين.
*   **`PUT /:id`**: تحديث بيانات مصروف معين.
*   **`DELETE /:id`**: حذف مصروف معين.

### د. إدارة حالة الطاولات (مقترح عبر WebSockets أو SSE)

*   حالة الطاولات (`TableStatus`) في لوحة المدير يجب أن تُحدّث بشكل فوري. بدلاً من عمل polling مستمر عبر HTTP، يُفضل استخدام:
    *   **Server-Sent Events (SSE):** لإرسال تحديثات من الخادم إلى العميل باتجاه واحد.
    *   **WebSockets:** لاتصال ثنائي الاتجاه أكثر تعقيداً إذا احتجنا تفاعلاً من المدير يعود للخادم.
*   الخادم يرسل حدثاً (event) كلما تغيرت حالة طلب (`new_order`, `confirmed`, `completed`).

---

هذا العقد هو الأساس الذي سنبني عليه الواجهة الخلفية. أي تعديلات مستقبلية يجب أن تُناقش وتُوثّق هنا أولاً لضمان التوافق بين الفريقين.
